# Cesium 卫星锥体投影演示需求文档

## 项目概述
基于 Cesium.js 的三维地球可视化演示，展示卫星轨道运行及其地面投影锥体效果。

---

## 1. 底图需求

### 1.1 底图类型
- **默认底图**：Dark Matter（CartoDB 深色底图）
- **备选底图**：
  - OpenStreetMap（标准街道地图）
  - CartoDB Positron（浅色底图）
  - Stamen Terrain（地形底图）
  - Cesium 默认（Bing Maps 卫星影像）

### 1.2 底图要求
- 无需 token 即可访问
- 支持底图实时切换
- 切换方式：下拉菜单选择

---

## 2. 卫星系统

### 2.1 卫星本体
- **表示方式**：显眼的点标记（黄色圆点 + 红色边框）
- **尺寸**：20像素
- **标签**：显示 "🛰️ 卫星" 文字

### 2.2 轨道参数
- **轨道高度**：800 km
- **轨道半径**：地球半径 + 800km = 7,171,000 m
- **轨道倾角**：51.6°（类似国际空间站）
- **运行周期**：90 分钟
- **时间倍速**：50x（加速播放）

### 2.3 轨道可视化
- 显示卫星轨道线（青色发光线条）
- 卫星在轨道上实时运动

---

## 3. 地面投影（星下点）

### 3.1 投影形状
- **形状**：椭圆
- **半长轴**：1000 km（总长 2000 km）
- **半短轴**：500 km（总长 1000 km）
- **轴比例**：2:1（长轴:短轴）
- **采样点数**：椭圆边缘均匀取 60 个点

### 3.2 投影要求
- 贴地显示，贴合地形表面
- 避免穿模（设置适当高度偏移）
- 随卫星运动实时更新位置

### 3.3 可视化元素
1. **边界线**：黄色闭合线（60个点连接）
2. **地面填充**：半透明红色（opacity 0.15）

---

## 4. 锥体投影

### 4.1 几何定义
- **顶点**：卫星位置
- **底面**：地面椭圆（60个点）
- **侧面**：从卫星到椭圆边缘的连线形成的锥面

### 4.2 可视化元素

#### 4.2.1 骨架线（锥体边缘线）
- 从卫星到地面椭圆各点的连线
- 每隔 3 个点画一条（共 20 条）
- 颜色：半透明橙色
- 线宽：1 像素

#### 4.2.2 侧面填充
- 使用三角形近似锥面
- 每 3 个点形成一个三角形扇区（共 20 个）
- 颜色：半透明橙黄色（opacity 0.08）
- 材质：可透视的半透明填充

#### 4.2.3 地面边界
- 椭圆边缘黄色闭合线
- 线宽：3 像素
- 沿地球表面绘制（geodesic）

---

## 5. 交互功能

### 5.1 视角控制
- **🌍 全球视角**：重置到俯视图
- **🛰️ 跟随卫星**：视角锁定跟踪卫星
- **⏯️ 暂停/播放**：控制动画运行

### 5.2 底图切换
- 右上角下拉菜单
- 实时切换不同底图

### 5.3 其他控件
- 时间轴：显示/控制当前模拟时间
- 动画控件：调节播放速度

---

## 6. 技术实现要求

### 6.1 性能优化
- 使用 `CallbackProperty` 动态计算位置
- 避免每帧删除重建实体
- 骨架线采样适当降低频率（20条而非60条）

### 6.2 坐标计算
- 椭圆参数方程转换为经纬度
- 考虑地球曲率进行坐标偏移计算
- 使用 `Cartesian3.fromDegrees` 转换为世界坐标

### 6.3 实体管理
- 卫星：使用 `SampledPositionProperty` 预采样轨道
- 地面元素：使用 `CallbackProperty` 实时计算
- 锥体：使用 Entity 的 polyline 和 polygon 组合

---

## 7. 视觉效果

### 7.1 配色方案
| 元素 | 颜色 | 透明度 |
|------|------|--------|
| 卫星 | 黄色 | 不透明 |
| 轨道线 | 青色 | 0.8 |
| 地面椭圆边界 | 黄色 | 0.9 |
| 地面椭圆填充 | 红色 | 0.15 |
| 锥体骨架线 | 橙黄色 | 0.5 |
| 锥体侧面 | 橙黄色 | 0.08 |

### 7.2 初始视角
- 位置：经度 0°, 纬度 20°, 高度 15,000,000 m
- 方向：俯视图（pitch -90°）

---

## 8. 文件结构
```
cesium-demo-kimi/
├── index.html          # 主程序文件
├── REQUIREMENTS.md     # 需求文档（本文件）
└── README.md           # 项目说明（可选）
```

---

## 9. 依赖项
- Cesium.js 1.114
- 无需额外依赖
- 使用 CDN 加载

---

## 10. 变更历史

### 底图变更
- 初始：ArcGIS World Imagery
- 变更：OpenStreetMap
- 最终：Dark Matter（CartoDB 深色）

### 椭圆尺寸变更
- 初始：10km × 10km
- 变更：200km × 100km
- 最终：2000km × 1000km

### 投影形状变更
- 初始：简单的星下点标记
- 变更：椭圆面
- 最终：完整锥体投影（卫星+地面椭圆+侧面填充）

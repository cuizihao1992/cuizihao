<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cesium 地球 Demo</title>
  <!-- Cesium 1.120 from jsDelivr -->
  <script>
    window.CESIUM_BASE_URL = 'https://cdn.jsdelivr.net/npm/cesium@1.120/Build/Cesium/';
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cesium@1.120/Build/Cesium/Widgets/widgets.min.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; }
    #cesiumContainer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    #toolbar {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    #toolbar button {
      padding: 8px 14px;
      font-size: 13px;
      cursor: pointer;
      border: 1px solid #444;
      border-radius: 6px;
      background: rgba(30, 30, 30, 0.9);
      color: #eee;
    }
    #toolbar button:hover {
      background: rgba(60, 60, 60, 0.95);
    }
  </style>
</head>
<body>
  <div id="toolbar">
    <button type="button" id="btnGlobal">全球视角</button>
    <button type="button" id="btnTrack">跟踪卫星</button>
    <button type="button" id="btnTop">俯视地球</button>
    <button type="button" id="btnSide">侧视轨道</button>
    <button type="button" id="btnDefault">默认视角</button>
  </div>
  <div id="cesiumContainer"></div>

  <script src="https://cdn.jsdelivr.net/npm/cesium@1.120/Build/Cesium/Cesium.js"></script>
  <script>
    Cesium.Ion.defaultAccessToken = null;

    const ARCGIS_TOKEN = 'AAPTxy8BH1VEsoebNVZXo8HurEOF051kAEKlhkOhBEc9BmTRbx8gaNqtBYKRq3vEnwSKnwUE1aRn2Siyo0gHWzzPwpJd-ZUeTyDgQZPqW8C6pXNLOE3bRO6-Jz3NFmp-qNquqGBQTATcCHbNsL-h9CPyMMPGsTcUvzPlIInazMfkWJNbFmqJeSzPj_1DHshXa0XCfkQn5mVxlF2dFt10Mq2bGo0HkpdpXwNQdoGwdphsLoU.AT1_CpQKgEim';
    const ESRI_WORLD_IMAGERY_URL = 'https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer';

    let viewer;

    (async function init() {
      try {
        const esriImagery = await Cesium.ArcGisMapServerImageryProvider.fromUrl(ESRI_WORLD_IMAGERY_URL, {
          token: ARCGIS_TOKEN
        });

        viewer = new Cesium.Viewer('cesiumContainer', {
          imageryProvider: esriImagery,
          baseLayerPicker: false,
          animation: true,
          timeline: true,
          fullscreenButton: true,
          vrButton: false,
          geocoder: true,
          homeButton: true,
          sceneModePicker: true,
          navigationHelpButton: true,
          useDefaultRenderLoop: true
        });

        runDemo();
      } catch (e) {
        console.error(e);
        document.body.insertAdjacentHTML('afterbegin', '<div style="position:fixed;top:10px;left:10px;z-index:9999;background:red;color:white;padding:10px;">底图加载失败: ' + (e.message || e) + '</div>');
      }
    })();

    function runDemo() {
    // 轨道卫星（惯性系、赤道圆轨道）
    let satelliteEntity;
    (function () {
      const earthRadius = 6371000;
      const orbitAltitude = 400000;
      const orbitRadius = earthRadius + orbitAltitude;
      const mu = 3.986004418e14;
      const orbitPeriod = 2 * Math.PI * Math.sqrt(Math.pow(orbitRadius, 3) / mu);

      const startTime = Cesium.JulianDate.now();
      const stopTime = Cesium.JulianDate.addSeconds(startTime, orbitPeriod, new Cesium.JulianDate());
      viewer.clock.startTime = startTime.clone();
      viewer.clock.stopTime = stopTime.clone();
      viewer.clock.currentTime = startTime.clone();
      viewer.clock.clockRange = Cesium.ClockRange.LOOP_STOP;
      viewer.clock.multiplier = 60;

      const positionProperty = new Cesium.SampledPositionProperty(Cesium.ReferenceFrame.INERTIAL);
      const sampleStep = 30;
      for (let i = 0; i <= orbitPeriod; i += sampleStep) {
        const angle = (2 * Math.PI * i) / orbitPeriod;
        const time = Cesium.JulianDate.addSeconds(startTime, i, new Cesium.JulianDate());
        positionProperty.addSample(time, new Cesium.Cartesian3(
          orbitRadius * Math.cos(angle),
          orbitRadius * Math.sin(angle),
          0
        ));
      }

      satelliteEntity = viewer.entities.add({
        name: '卫星',
        position: positionProperty,
        orientation: new Cesium.VelocityOrientationProperty(positionProperty),
        point: {
          pixelSize: 16,
          color: Cesium.Color.CYAN,
          outlineColor: Cesium.Color.WHITE,
          outlineWidth: 2
        },
        label: {
          text: '卫星',
          font: '14pt sans-serif',
          fillColor: Cesium.Color.CYAN,
          outlineColor: Cesium.Color.BLACK,
          outlineWidth: 2,
          style: Cesium.LabelStyle.FILL_AND_OUTLINE,
          verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
          pixelOffset: new Cesium.Cartesian2(0, -20),
          scaleByDistance: new Cesium.NearFarScalar(1e6, 1.2, 5e7, 0.25),
          disableDepthTestDistance: Number.POSITIVE_INFINITY
        },
        box: {
          dimensions: new Cesium.Cartesian3(20, 10, 10),
          material: Cesium.Color.SILVER,
          outlineColor: Cesium.Color.WHITE,
          outlineWidth: 1
        }
      });
    })();

    // 视角按钮
    document.getElementById('btnGlobal').onclick = function () {
      viewer.trackedEntity = undefined;
      viewer.camera.flyTo({
        destination: Cesium.Cartesian3.fromDegrees(0, 20, 28000000),
        duration: 1.2
      });
    };
    document.getElementById('btnTrack').onclick = function () {
      viewer.trackedEntity = satelliteEntity;
    };
    document.getElementById('btnTop').onclick = function () {
      viewer.trackedEntity = undefined;
      viewer.camera.flyTo({
        destination: Cesium.Cartesian3.fromDegrees(0, 90, 15000000),
        orientation: { heading: 0, pitch: -Cesium.Math.PI_OVER_TWO, roll: 0 },
        duration: 1.2
      });
    };
    document.getElementById('btnSide').onclick = function () {
      viewer.trackedEntity = undefined;
      viewer.camera.flyTo({
        destination: new Cesium.Cartesian3(0, 0, 18000000),
        orientation: { heading: 0, pitch: -Cesium.Math.PI_OVER_TWO, roll: 0 },
        duration: 1.2
      });
    };
    document.getElementById('btnDefault').onclick = function () {
      viewer.trackedEntity = undefined;
      viewer.camera.flyTo({
        destination: Cesium.Cartesian3.fromDegrees(0, 20, 12000000),
        duration: 1.2
      });
    };

    // 初始视角
    viewer.camera.flyTo({
      destination: Cesium.Cartesian3.fromDegrees(0, 20, 12000000),
      duration: 1.5
    });
    }
  </script>
</body>
</html>
